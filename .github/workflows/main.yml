name: Python CI ğŸš€

on:
push:
branches: \[main]
pull\_request:
branches: \[main]

jobs:
setup:
name: ğŸ› ï¸ Setup & Cache
runs-on: ubuntu-latest
strategy:
matrix:
python-version: \['3.9', '3.10', '3.11']
steps:
\- name: ğŸ›’ Checkout code
uses: actions/checkout\@v3


  - name: Cache pip
    uses: actions/cache@v3
    with:
      path: ~/.cache/pip
      key: ${{ runner.os }}-pip-${{ hashFiles('**/pyproject.toml') }}

  - name: ğŸ Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: ${{ matrix.python-version }}

  - name: ğŸ“¦ Install dependencies
    run: |
      python -m pip install --upgrade pip
      pip install .


lint\_and\_security:
name: ğŸ” Lint & Security
runs-on: ubuntu-latest
needs: setup
steps:
\- name: ğŸ›’ Checkout code
uses: actions/checkout\@v3


  - name: ğŸ Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: ${{ matrix.python-version }}

  - name: ğŸ“¦ Install tools
    run: pip install ruff bandit safety

  - name: ğŸ§ Run Ruff Lint
    run: ruff check .

  - name: ğŸ•µï¸ Bandit Security Analysis
    run: bandit -r . -x developpement_logiciel/tests

  - name: ğŸ”’ Safety Scan
    run: safety check --full-report


test:
name: ğŸ§ª Pytest with Coverage
runs-on: ubuntu-latest
needs: lint\_and\_security
steps:
\- name: ğŸ›’ Checkout code
uses: actions/checkout\@v3


  - name: ğŸ Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: ${{ matrix.python-version }}

  - name: ğŸ“¦ Install test dependencies
    run: pip install pytest pytest-cov

  - name: ğŸ§ª Run Pytest with Coverage
    run: pytest --cov=developpement_logiciel --cov-report=term-missing --cov-fail-under=80

